{
 "build_module" : "builder",
 "items" : [
  {
   "$ xns" : "Gtk",
   "Gtk.PositionType position" : "Gtk.PositionType.RIGHT",
   "Project.Gtk project" : "null",
   "Xcls_MainWindow window" : "null",
   "bool done" : false,
   "bool modal" : true,
   "items" : [
    {
     "$ xns" : "Gtk",
     "* pack" : "add",
     "Gtk.Orientation orientation" : "Gtk.Orientation.VERTICAL",
     "bool hexpand" : true,
     "bool vexpand" : true,
     "items" : [
      {
       "$ xns" : "Gtk",
       "* pack" : "add",
       "string title" : "Change Vala Project Compile settings",
       "xtype" : "HeaderBar"
      },
      {
       "$ xns" : "Gtk",
       "* pack" : "pack_start,true,true,0",
       "items" : [
        {
         "$ xns" : "Gtk",
         "* pack" : false,
         "id" : "label_global",
         "utf8 label" : "Global",
         "xtype" : "Label"
        },
        {
         "$ xns" : "Gtk",
         "* pack" : false,
         "id" : "label_targets",
         "utf8 label" : "Targets",
         "xtype" : "Label"
        },
        {
         "$ xns" : "Gtk",
         "* pack" : "append_page,_this.label_global.el",
         "Gtk.Orientation orientation" : "Gtk.Orientation.VERTICAL",
         "gboolean homogeneous" : false,
         "items" : [
          {
           "$ xns" : "Gtk",
           "* pack" : "pack_start,false,false,0",
           "utf8 label" : "compile flags",
           "xtype" : "Label"
          },
          {
           "$ xns" : "Gtk",
           "* pack" : "pack_start,false,false,0",
           "id" : "compile_flags",
           "listeners" : {
            "changed" : [
             "() => {",
             "    ",
             "   _this.project.compilegroups.get(\"_default_\").compile_flags = this.el.text;",
             "   _this.project.writeConfig();",
             "//    _this.project.save();",
             "",
             "}"
            ]
           },
           "utf8 placeholder_text" : "eg. -g --valasrc $BASEDIR ",
           "xtype" : "Entry"
          },
          {
           "$ xns" : "Gtk",
           "* pack" : "pack_start,true,true,0",
           "Gtk.Orientation orientation" : "Gtk.Orientation.HORIZONTAL",
           "int position" : 300,
           "items" : [
            {
             "$ xns" : "Gtk",
             "* pack" : "add",
             "bool hexpand" : true,
             "items" : [
              {
               "$ xns" : "Gtk",
               "* pack" : "add",
               "gboolean headers_visible" : true,
               "items" : [
                {
                 "$ columns" : [
                  "    typeof(string),  // 0 key type",
                  "      typeof(bool)"
                 ],
                 "$ n_columns" : 2,
                 "$ xns" : "Gtk",
                 "* pack" : "set_model",
                 "id" : "default_packages_tree_store",
                 "xtype" : "ListStore",
                 "| void load" : [
                  "() {",
                  " ",
                  "    var def = _this.project.compilegroups.get(\"_default_\");",
                  "    var items  = def.packages;",
                  "    ",
                  "    this.el.clear();",
                  "    var pal = (Palete.Gtk) _this.project.palete;",
                  "    var pkgs = pal.packages(_this.project);",
                  "    print(\"ValaProjectSettings:packages load %d\\n\", pkgs.size);",
                  "",
                  "    Gtk.TreeIter citer;",
                  "",
                  "    for(var i =0 ; i < pkgs.size; i++) {",
                  "         this.el.append(out citer);   ",
                  "         ",
                  "        this.el.set_value(citer, 0,   pkgs.get(i) ); // title ",
                  "        this.el.set_value(citer, 1,   items.contains(pkgs.get(i)) );",
                  "    }",
                  "    this.el.set_sort_column_id(0,Gtk.SortType.ASCENDING);",
                  "    ",
                  "}",
                  ""
                 ]
                },
                {
                 "$ xns" : "Gtk",
                 "* init" : [
                  " ",
                  " this.el.add_attribute(_this.packages_render.el , \"text\", 0 );",
                  "  "
                 ],
                 "* pack" : "append_column",
                 "gboolean expand" : true,
                 "gboolean resizable" : true,
                 "items" : [
                  {
                   "$ xns" : "Gtk",
                   "* pack" : "pack_start,false",
                   "id" : "packages_render",
                   "xtype" : "CellRendererText"
                  }
                 ],
                 "utf8 title" : "package name",
                 "xtype" : "TreeViewColumn"
                },
                {
                 "$ xns" : "Gtk",
                 "* init" : [
                  "{",
                  " this.el.add_attribute(_this.packages_render_use.el , \"active\", 1 );",
                  " }"
                 ],
                 "* pack" : "append_column",
                 "gboolean resizable" : false,
                 "gint fixed_width" : 50,
                 "items" : [
                  {
                   "$ xns" : "Gtk",
                   "* pack" : "pack_start,false",
                   "gboolean activatable" : true,
                   "id" : "packages_render_use",
                   "listeners" : {
                    "toggled" : [
                     "(  path_string) =>  { ",
                     "    var m = _this.default_packages_tree_store.el;",
                     "   Gtk.TreeIter iter;",
                     "   Gtk.TreePath path = new Gtk.TreePath.from_string (path_string);",
                     "   m.get_iter (out iter, path);",
                     "   GLib.Value val;",
                     "   m.get_value(iter, 1, out val);",
                     "   m.set_value(iter, 1,  ((bool) val) ? false :true); ",
                     "     GLib.Value fval;  ",
                     "   m.get_value(iter, 0, out fval);",
                     "   var fn = (string)fval;",
                     "    ",
                     "    var def = _this.project.compilegroups.get(\"_default_\");",
                     "    var items  = def.packages;",
                     "    if ((bool)val) {",
                     "        // renive",
                     "        items.remove(fn);",
                     "    } else {",
                     "        items.add(fn);",
                     "    }",
                     "    ",
                     "}"
                    ]
                   },
                   "xtype" : "CellRendererToggle"
                  }
                 ],
                 "utf8 title" : "use",
                 "xtype" : "TreeViewColumn"
                }
               ],
               "string id" : "default_packages_tree",
               "xtype" : "TreeView"
              }
             ],
             "xtype" : "ScrolledWindow"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "add2",
             "bool hexpand" : true,
             "items" : [
              {
               "$ xns" : "Gtk",
               "* pack" : "add",
               "gboolean headers_visible" : true,
               "id" : "default_directory_tree",
               "items" : [
                {
                 "$ columns" : [
                  "    typeof(string)",
                  "     "
                 ],
                 "$ n_columns" : 1,
                 "$ xns" : "Gtk",
                 "* pack" : "set_model",
                 "id" : "default_directory_tree_store",
                 "xtype" : "ListStore",
                 "| void load" : [
                  "() {",
                  " ",
                  "  this.el.clear();",
                  "  ",
                  "    ",
                  "     var def = _this.project.compilegroups.get(\"_default_\");",
                  "     var items  = def.sources;",
                  "     ",
                  " ",
                  "    Gtk.TreeIter citer;",
                  "",
                  "    for(var i =0 ; i < items.size; i++) {",
                  "         this.el.append(out citer);   ",
                  "         ",
                  "        this.el.set_value(citer, 0,   items.get(i) ); // title ",
                  "        //this.el.set_value(citer, 1,   items.get(i) );",
                  "    }",
                  "    this.el.set_sort_column_id(0,Gtk.SortType.ASCENDING);",
                  "    ",
                  "}",
                  ""
                 ]
                },
                {
                 "$ xns" : "Gtk",
                 "* init" : [
                  "",
                  " this.el.add_attribute(_this.directory_render.el , \"text\", 0 );",
                  "   "
                 ],
                 "* pack" : "append_column",
                 "gboolean resizable" : true,
                 "items" : [
                  {
                   "$ xns" : "Gtk",
                   "* pack" : "pack_start,false",
                   "id" : "directory_render",
                   "xtype" : "CellRendererText"
                  }
                 ],
                 "utf8 title" : "Available Directories (right click to add)",
                 "xtype" : "TreeViewColumn"
                }
               ],
               "listeners" : {
                "button_press_event" : [
                 " ( ev) => {",
                 "    //console.log(\"button press?\");",
                 "   ",
                 "    ",
                 "    if (ev.type != Gdk.EventType.BUTTON_PRESS  || ev.button != 3) {",
                 "        //print(\"click\" + ev.type);",
                 "        return false;",
                 "    }",
                 "    //Gtk.TreePath res;",
                 "    //if (!this.el.get_path_at_pos((int)ev.x,(int)ev.y, out res, null, null, null) ) {",
                 "    //    return true;",
                 "    //}",
                 "     ",
                 "  //  this.el.get_selection().select_path(res);",
                 "     ",
                 "      //if (!this.get('/LeftTreeMenu').el)  { ",
                 "      //      this.get('/LeftTreeMenu').init(); ",
                 "      //  }",
                 "        ",
                 "     _this.default_directory_menu.el.set_screen(Gdk.Screen.get_default());",
                 "     _this.default_directory_menu.el.show_all();",
                 "      _this.default_directory_menu.el.popup(null, null, null,  3, ev.time);",
                 "     //   print(\"click:\" + res.path.to_string());",
                 "      return true;",
                 "}"
                ]
               },
               "xtype" : "TreeView"
              },
              {
               "$ xns" : "Gtk",
               "id" : "default_directory_menu",
               "items" : [
                {
                 "$ xns" : "Gtk",
                 "* pack" : "add",
                 "listeners" : {
                  "activate" : [
                   "()  => {",
                   "    ",
                   "    var  chooser = new Gtk.FileChooserDialog (",
                   "\t\"Add a directory\", _this.window.el, Gtk.FileChooserAction.SELECT_FOLDER ,",
                   "\t\"_Cancel\",",
                   "\tGtk.ResponseType.CANCEL,",
                   "\t\"_Add\",",
                   "\tGtk.ResponseType.ACCEPT);",
                   "    if (chooser.run () != Gtk.ResponseType.ACCEPT) {",
                   "        chooser.close ();",
                   "           return;",
                   "       }",
                   "       chooser.close ();",
                   "       // add the directory..",
                   "       var fn = _this.project.relPath(chooser.get_filename());",
                   "       _this.project.compilegroups.get(\"_default_\").sources.add(fn);",
                   "       _this.default_directory_tree_store.load();",
                   "}"
                  ]
                 },
                 "utf8 label" : "Add Directory",
                 "xtype" : "MenuItem"
                },
                {
                 "$ xns" : "Gtk",
                 "* pack" : "add",
                 "listeners" : {
                  "activate" : [
                   "()  => {",
                   "    ",
                   "    var  chooser = new Gtk.FileChooserDialog (",
                   "\t\"Add a directory\", _this.window.el, Gtk.FileChooserAction.OPEN ,",
                   "\t\"_Cancel\",",
                   "\tGtk.ResponseType.CANCEL,",
                   "\t\"_Add\",",
                   "\tGtk.ResponseType.ACCEPT);",
                   "    if (chooser.run () != Gtk.ResponseType.ACCEPT) {",
                   "        chooser.close ();",
                   "           return;",
                   "       }",
                   "       chooser.close ();",
                   "       // add the directory..",
                   "       var fn = _this.project.relPath(chooser.get_filename());",
                   "       _this.project.compilegroups.get(\"_default_\").sources.add(fn);",
                   "       _this.default_directory_tree_store.load();",
                   "}"
                  ]
                 },
                 "utf8 label" : "Add File",
                 "xtype" : "MenuItem"
                },
                {
                 "$ xns" : "Gtk",
                 "* pack" : "add",
                 "xtype" : "SeparatorMenuItem"
                },
                {
                 "$ xns" : "Gtk",
                 "* pack" : "add",
                 "listeners" : {
                  "activate" : [
                   "()  => {",
                   "    ",
                   "     //",
                   "        Gtk.TreeModel mod;",
                   "        Gtk.TreeIter iter;",
                   "        if (!_this.default_directory_tree.el.get_selection().get_selected(out mod, out iter)) {",
                   "               print(\"nothing selected\\n\");",
                   "            return;",
                   "        }",
                   "",
                   "            ",
                   "       // add the directory..",
                   "       ",
                   "       ",
                   "       GLib.Value val;",
                   "        mod.get_value(iter,0, out val);",
                   "       var fn =  (string) val;",
                   "       ",
                   "       print(\"remove: %s\\n\", fn);",
                   "       if (!_this.project.compilegroups.get(\"_default_\").sources.remove(fn)) {",
                   "                  print(\"remove failed\");",
                   "              }",
                   "       _this.default_directory_tree_store.load();",
                   "}"
                  ]
                 },
                 "utf8 label" : "Remove File/Directory",
                 "xtype" : "MenuItem"
                }
               ],
               "xtype" : "Menu"
              }
             ],
             "xtype" : "ScrolledWindow"
            }
           ],
           "xtype" : "Paned"
          }
         ],
         "xtype" : "Box"
        },
        {
         "$ xns" : "Gtk",
         "* pack" : "append_page,_this.label_targets.el",
         "Gtk.Orientation orientation" : "Gtk.Orientation.HORIZONTAL",
         "gint position" : 300,
         "items" : [
          {
           "$ xns" : "Gtk",
           "* init" : [
            "{  ",
            "this.el.set_policy (Gtk.PolicyType.AUTOMATIC, Gtk.PolicyType.AUTOMATIC);",
            "",
            "}",
            ""
           ],
           "* pack" : "add1",
           "items" : [
            {
             "$ xns" : "Gtk",
             "* pack" : "add",
             "id" : "targets_tree_menu",
             "items" : [
              {
               "$ xns" : "Gtk",
               "* pack" : "add",
               "listeners" : {
                "activate" : [
                 "()  => {",
                 "    ",
                 "       if (_this.project.compilegroups.has_key(\"NEW GROUP\")) {",
                 "        return;",
                 "    }",
                 "      ",
                 "       // add the directory..",
                 "       ",
                 "       _this.project.compilegroups.set(\"NEW GROUP\", new Project.GtkValaSettings(\"NEW GROUP\"));",
                 "       _this.targets_tree_store.load();",
                 "}"
                ]
               },
               "utf8 label" : "Add Compile Target",
               "xtype" : "MenuItem"
              },
              {
               "$ xns" : "Gtk",
               "* pack" : "add",
               "xtype" : "SeparatorMenuItem"
              },
              {
               "$ xns" : "Gtk",
               "* pack" : "add",
               "listeners" : {
                "activate" : [
                 "()  => {",
                 "    ",
                 "     //",
                 "        Gtk.TreeModel mod;",
                 "        Gtk.TreeIter iter;",
                 "        if (!_this.targets_tree.el.get_selection().get_selected(out mod, out iter)) {",
                 "               print(\"nothing selected\\n\");",
                 "            return;",
                 "        }",
                 "",
                 "            ",
                 "       // add the directory..",
                 "       ",
                 "       ",
                 "       GLib.Value val;",
                 "        mod.get_value(iter,0, out val);",
                 "       var fn =  (string) val;",
                 "       ",
                 "       print(\"remove: %s\\n\", fn);",
                 "       if (!_this.project.compilegroups.unset(fn)) {",
                 "                  print(\"remove failed\");",
                 "      }",
                 "       _this.targets_tree_store.load();",
                 "}"
                ]
               },
               "utf8 label" : "Remove Target",
               "xtype" : "MenuItem"
              }
             ],
             "xtype" : "Menu"
            },
            {
             "# string cursor" : "",
             "$ xns" : "Gtk",
             "* pack" : "add",
             "id" : "targets_tree",
             "items" : [
              {
               "$ columns" : [
                "    typeof(string),  // 0 key type",
                "     typeof(string) // ??",
                "     "
               ],
               "$ n_columns" : 2,
               "$ xns" : "Gtk",
               "* pack" : "set_model",
               "id" : "targets_tree_store",
               "xtype" : "ListStore",
               "| void load" : [
                "() {",
                " ",
                "  this.el.clear();",
                "  ",
                "    ",
                "     var cg = _this.project.compilegroups;",
                "     ",
                "   _this.targets_tree.cursor = \"\";",
                "    Gtk.TreeIter citer;",
                "    var iter = cg.map_iterator();",
                "   while(iter.next()) {",
                "        var key = iter.get_key();",
                "        if (key == \"_default_\") {",
                "            continue;",
                "        }",
                "    ",
                "         this.el.append(out citer);   ",
                "         ",
                "        this.el.set_value(citer, 0,   key ); // title ",
                "        //this.el.set_value(citer, 1,   items.get(i) );",
                "    };",
                "    this.el.set_sort_column_id(0,Gtk.SortType.ASCENDING);",
                "    _this.set_vbox.el.hide();",
                "}",
                ""
               ]
              },
              {
               "$ xns" : "Gtk",
               "* init" : [
                " {",
                "     this.el.add_attribute(_this.targets_render.el , \"text\", 0 );",
                " }"
               ],
               "* pack" : "append_column",
               "gboolean resizable" : true,
               "items" : [
                {
                 "$ xns" : "Gtk",
                 "* pack" : "pack_start,false",
                 "gboolean editable" : true,
                 "id" : "targets_render",
                 "listeners" : {
                  "edited" : [
                   "  (path, newtext) => {",
                   "     ",
                   "     Gtk.TreeIter  iter;",
                   "        _this.targets_tree_store.el.get_iter(out iter, new Gtk.TreePath.from_string(path));",
                   "       GLib.Value gval;",
                   "        _this.targets_tree_store.el.get_value(iter,0, out gval);",
                   "        var oldval = (string)gval;",
                   "       if (oldval == newtext) {",
                   "          return;",
                   "        }",
                   "         var cg = _this.project.compilegroups.get(oldval);",
                   "        cg.name = newtext;",
                   "        _this.project.compilegroups.unset(oldval);",
                   "        _this.project.compilegroups.set(newtext, cg);",
                   "       _this.targets_tree_store.load();",
                   "  }"
                  ]
                 },
                 "xtype" : "CellRendererText"
                }
               ],
               "utf8 title" : "name",
               "xtype" : "TreeViewColumn"
              }
             ],
             "listeners" : {
              "button_press_event" : [
               " ( ev) => {",
               "    //console.log(\"button press?\");",
               "   ",
               "    ",
               "    if (ev.type != Gdk.EventType.BUTTON_PRESS  || ev.button != 3) {",
               "        //print(\"click\" + ev.type);",
               "        return false;",
               "    }",
               "    //Gtk.TreePath res;",
               "    //if (!this.el.get_path_at_pos((int)ev.x,(int)ev.y, out res, null, null, null) ) {",
               "    //    return true;",
               "    //}",
               "     ",
               "  //  this.el.get_selection().select_path(res);",
               "     ",
               "      //if (!this.get('/LeftTreeMenu').el)  { ",
               "      //      this.get('/LeftTreeMenu').init(); ",
               "      //  }",
               "        ",
               "     _this.targets_tree_menu.el.set_screen(Gdk.Screen.get_default());",
               "     _this.targets_tree_menu.el.show_all();",
               "      _this.targets_tree_menu.el.popup(null, null, null,  3, ev.time);",
               "     //   print(\"click:\" + res.path.to_string());",
               "      return true;",
               "}"
              ],
              "cursor_changed" : [
               " ( ) => {",
               "",
               "    if (this.cursor != \"\") {",
               "         // save the values..",
               "     }",
               "     ",
               "     // load the new values.",
               "     ",
               "",
               "         Gtk.TreeModel mod;",
               "        Gtk.TreeIter iter;",
               "        if (!this.el.get_selection().get_selected(out mod, out iter)) {",
               "            print(\"nothing selected\\n\");",
               "            // should disable the right hand side..",
               "            _this.set_vbox.el.hide();",
               "            return;",
               "        }",
               "        _this.set_vbox.el.show();",
               "            ",
               "       // add the directory..",
               "       ",
               "       ",
               "       GLib.Value val;",
               "        mod.get_value(iter,0, out val);",
               "       var fn =  (string) val;",
               "       ",
               "       this.cursor = fn;",
               "       var cg = _this.project.compilegroups.get(fn);",
               "       ",
               "       _this.build_pack_target.el.set_text(cg.target_bin);",
               "       _this.build_compile_flags.el.set_text(cg.compile_flags);",
               "\t\t_this.build_execute_args.el.set_text(cg.execute_args);",
               "       ",
               "       _this.set_vbox.cgroup = cg;",
               "       _this.files_tree_store.update();",
               "       ",
               "       // load the srouces",
               "",
               "",
               "  }"
              ]
             },
             "xtype" : "TreeView"
            }
           ],
           "xtype" : "ScrolledWindow"
          },
          {
           "# Project.GtkValaSettings cgroup" : "null",
           "$ xns" : "Gtk",
           "* pack" : "add2",
           "Gtk.Orientation orientation" : "Gtk.Orientation.VERTICAL",
           "gboolean homogeneous" : false,
           "id" : "set_vbox",
           "items" : [
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,false,false,0",
             "utf8 label" : "target filename",
             "xtype" : "Label"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,false,false,0",
             "id" : "build_pack_target",
             "listeners" : {
              "changed" : [
               "()  => {",
               "        if (_this.targets_tree.cursor.length < 1) {",
               "        return;",
               "    }",
               "    _this.project.compilegroups.get(_this.targets_tree.cursor).target_bin = this.el.text;",
               "}"
              ]
             },
             "xtype" : "Entry"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,false,false,0",
             "utf8 label" : "compile flags",
             "xtype" : "Label"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,false,false,0",
             "id" : "build_compile_flags",
             "listeners" : {
              "changed" : [
               "() => {",
               "    if (_this.targets_tree.cursor.length < 1) {",
               "        return;",
               "    }",
               "    _this.project.compilegroups.get(_this.targets_tree.cursor).compile_flags = this.el.text;",
               "}"
              ]
             },
             "xtype" : "Entry"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,false,false,0",
             "utf8 label" : "test argments - when run after a build",
             "xtype" : "Label"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,false,false,0",
             "id" : "build_execute_args",
             "listeners" : {
              "changed" : [
               "() => {",
               "    if (_this.targets_tree.cursor.length < 1) {",
               "        return;",
               "    }",
               "    _this.project.compilegroups.get(_this.targets_tree.cursor).execute_args = this.el.text;",
               "}"
              ]
             },
             "string placeholder_text" : "eg.  -f somefile -g ",
             "xtype" : "Entry"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,false,false,0",
             "utf8 label" : "Files to compile",
             "xtype" : "Label"
            },
            {
             "$ xns" : "Gtk",
             "* pack" : "pack_start,true,true,0",
             "items" : [
              {
               "$ xns" : "Gtk",
               "* pack" : "add",
               "items" : [
                {
                 "$ columns" : [
                  "    typeof(string),  // 0 file name",
                  "        typeof(string),  // 0 basename",
                  "     typeof(string), // type (dir orfile)",
                  "     typeof(bool)  // is checked.",
                  "     "
                 ],
                 "$ n_columns" : 4,
                 "$ xns" : "Gtk",
                 "* pack" : "set_model",
                 "id" : "files_tree_store",
                 "xtype" : "ListStore",
                 "| void load" : [
                  "() {",
                  " ",
                  "      this.el.clear();",
                  "  ",
                  "    ",
                  "     var def = _this.project.compilegroups.get(\"_default_\");",
                  "     var items  = def.sources;",
                  "     ",
                  "     ",
                  "     ",
                  "     ",
                  " ",
                  "    Gtk.TreeIter citer;",
                  "",
                  "    for(var i =0 ; i < items.size; i++) {",
                  "    ",
                  "         var files = _this.project.filesForCompile(items.get(i), false);",
                  "         if (files.size < 1) {",
                  "            continue;",
                  "         }",
                  "    ",
                  "         this.el.append(out citer);   ",
                  "         ",
                  "        this.el.set_value(citer, 0,   items.get(i) ); // title ",
                  "        this.el.set_value(citer, 1,   \"<span foreground=\\\"green\\\" font_weight=\\\"bold\\\">\" + ",
                  "                    GLib.Markup.escape_text(items.get(i)) + \"</span>\"",
                  "            ); // title ",
                  "        print(\"ADD item %s\", items.get(i));",
                  "        this.el.set_value(citer, 2,   \"dir\"); // type         ",
                  "        this.el.set_value(citer, 3,   false ); // checked ",
                  "",
                  "       ",
                  "        ",
                  "         for(var j =0 ; j < files.size; j++) {",
                  "            this.el.append(out citer);   ",
                  "             print(\"ADD item %s\", files.get(j));",
                  "            this.el.set_value(citer, 0,   files.get(j) ); // title ",
                  "            this.el.set_value(citer, 1,   GLib.Markup.escape_text( Path.get_basename (files.get(j))) ); // title             ",
                  "            this.el.set_value(citer, 2,   \"file\"); // type         ",
                  "            this.el.set_value(citer, 3,   false ); // checked ",
                  "",
                  "        }",
                  "        ",
                  "        ",
                  "        //this.el.set_value(citer, 1,   items.get(i) );",
                  "    }",
                  "    this.el.set_sort_column_id(0,Gtk.SortType.ASCENDING);",
                  "    if (_this.set_vbox.cgroup == null) {",
                  "\t\t_this.set_vbox.el.set_sensitive(false);",
                  "    ",
                  "    }",
                  "}",
                  " "
                 ],
                 "| void update" : [
                  "() {",
                  "",
                  "",
                  "    Gtk.TreeIter citer;",
                  "",
                  "    for(var i =0 ; i < this.el.iter_n_children(null); i++) {",
                  "        this.el.iter_nth_child(out citer,null,i);",
                  "",
                  "        GLib.Value val;",
                  "        this.el.get_value(citer,0, out val);",
                  "        var fn = (string) val;",
                  "        ",
                  "        var active = false;",
                  "        if (_this.set_vbox.cgroup.sources.contains(fn)) {",
                  "            active = true;",
                  "        }",
                  "        ",
                  "        this.el.set_value(citer, 3,   active ); // checked ",
                  "    }",
                  "",
                  "     _this.set_vbox.el.set_sensitive(true);",
                  "}",
                  ""
                 ],
                 "| void updateDir" : [
                  "(string dname, bool bval) {",
                  "  ",
                  "  Gtk.TreeIter citer;",
                  "",
                  "    var cg =   _this.set_vbox.cgroup;",
                  "  for(var i =0 ; i < this.el.iter_n_children(null); i++) {",
                  "        this.el.iter_nth_child(out citer,null,i);",
                  "",
                  "        GLib.Value val;",
                  "        this.el.get_value(citer,0, out val);",
                  "        var fn = (string) val;",
                  "        ",
                  "        if ( Path.get_dirname (fn) == dname) {",
                  "        ",
                  "            this.el.set_value(citer, 3,   bval ); // checked ",
                  "           ",
                  "     ",
                  "     ",
                  "            if (!bval) {",
                  "                // renive",
                  "                if (cg.sources.contains(fn)) {",
                  "                    cg.sources.remove(fn);",
                  "                }",
                  "            } else {",
                  "                if (!cg.sources.contains(fn)) {",
                  "                    cg.sources.add(fn);",
                  "                }",
                  "            }",
                  "            ",
                  "            ",
                  "        }",
                  "    }",
                  "",
                  "}",
                  ""
                 ]
                },
                {
                 "$ xns" : "Gtk",
                 "* init" : [
                  "",
                  " this.el.add_attribute(_this.files_render.el , \"markup\", 1 ); // basnemae",
                  " ",
                  "/*  this.el.add_attribute(_this.files_render.el , \"markup\", 2 );",
                  "*/"
                 ],
                 "* pack" : "append_column",
                 "gboolean resizable" : true,
                 "items" : [
                  {
                   "$ xns" : "Gtk",
                   "* pack" : "pack_start,false",
                   "id" : "files_render",
                   "xtype" : "CellRendererText"
                  }
                 ],
                 "utf8 title" : "name",
                 "xtype" : "TreeViewColumn"
                },
                {
                 "$ xns" : "Gtk",
                 "* init" : [
                  "{",
                  " this.el.add_attribute(_this.files_render_use.el , \"active\", 3 );",
                  " }"
                 ],
                 "* pack" : "append_column",
                 "gboolean resizable" : false,
                 "gint fixed_width" : 50,
                 "items" : [
                  {
                   "$ xns" : "Gtk",
                   "* pack" : "pack_start,false",
                   "gboolean activatable" : true,
                   "id" : "files_render_use",
                   "listeners" : {
                    "toggled" : [
                     "(  path_string) =>  { ",
                     "",
                     "",
                     "",
                     "    var m = _this.files_tree_store.el;",
                     "   Gtk.TreeIter iter;",
                     "   Gtk.TreePath path = new Gtk.TreePath.from_string (path_string);",
                     "   m.get_iter (out iter, path);",
                     "   GLib.Value val;",
                     "   m.get_value(iter, 3, out val);",
                     "   m.set_value(iter, 3,  ((bool) val) ? false :true); ",
                     "   ",
                     "   // type.",
                     "   GLib.Value ftval;  ",
                     "   m.get_value(iter, 2, out ftval);",
                     "   var ftype = (string)ftval;   ",
                     "   ",
                     "   // full name...  ",
                     "   GLib.Value fval;     ",
                     "   m.get_value(iter, 0, out fval);",
                     "   var fn = (string)fval;",
                     "    ",
                     "    ",
                     "    var cg =   _this.set_vbox.cgroup;",
                     "    // what's the sleected target?",
                     "    // update the list..",
                     "    // if ftype is a dir == then toggle all the bellow.",
                     "    ",
                     "    if (ftype == \"dir\") {",
                     "        _this.files_tree_store.updateDir(fn,  ((bool) val) ? false :true);",
                     "    }",
                     "    ",
                     "    // if ftype is a file .. see if all the files in that directory are check and check the dir.",
                     "",
                     "     ",
                     "    if ((bool)val) {",
                     "        // renive",
                     "        cg.sources.remove(fn);",
                     "    } else {",
                     "        cg.sources.add(fn);",
                     "    }",
                     "    ",
                     "}"
                    ]
                   },
                   "xtype" : "CellRendererToggle"
                  }
                 ],
                 "utf8 title" : "use",
                 "xtype" : "TreeViewColumn"
                }
               ],
               "string id" : "files_tree",
               "xtype" : "TreeView"
              }
             ],
             "xtype" : "ScrolledWindow"
            }
           ],
           "xtype" : "Box"
          }
         ],
         "xtype" : "Paned"
        }
       ],
       "xtype" : "Notebook"
      },
      {
       "$ xns" : "Gtk",
       "* pack" : "add",
       "int margin_bottom" : 4,
       "int margin_left" : 4,
       "int margin_right" : 4,
       "int margin_top" : 4,
       "items" : [
        {
         "$ xns" : "Gtk",
         "* pack" : "add",
         "listeners" : {
          "clicked" : [
           "() => { ",
           "",
           "  _this.done = true;",
           "    _this.el.hide(); ",
           "}"
          ]
         },
         "string label" : "Cancel",
         "xtype" : "Button"
        },
        {
         "$ xns" : "Gtk",
         "* pack" : "add",
         "id" : "save_btn",
         "listeners" : {
          "clicked" : [
           "( ) =>  { ",
           "",
           " ",
           "_this.project.writeConfig(); ",
           " ",
           "\t// what about .js ?",
           "   _this.done = true;",
           "\t_this.el.hide();",
           "",
           "// hopefull this will work with bjs files..",
           "\t",
           " ",
           "   ",
           "}"
          ]
         },
         "string label" : "Save",
         "xtype" : "Button"
        }
       ],
       "xtype" : "HButtonBox"
      }
     ],
     "xtype" : "Box"
    }
   ],
   "listeners" : {
    "closed" : [
     "( ) => {",
     "  if (!this.done) {",
     "    _this.el.show_all();",
     "  ",
     "  }",
     "",
     "}",
     ""
    ],
    "hide" : [
     "() => {",
     "\t  if (!this.done) {",
     "    _this.el.show();",
     "  ",
     "  }",
     "}"
    ]
   },
   "uint border_width" : 0,
   "xtype" : "Popover",
   "| void save" : [
    "()  {",
    "    this.project.writeConfig(); ",
    "}"
   ],
   "| void show" : [
    "(Gtk.Widget btn, Project.Gtk project) {",
    "     ",
    "    //print(\"ValaProjectSettings show\\n\");",
    "    ",
    "    this.project=  project;",
    "",
    "    this.compile_flags.el.text = _this.project.compilegroups.get(\"_default_\").compile_flags;",
    "    ",
    "    this.default_directory_tree_store.load();    ",
    "    this.default_packages_tree_store.load();            ",
    "    this.targets_tree_store.load();",
    "    this.files_tree_store.load();",
    "",
    "",
    "\tthis.el.set_modal(true);",
    "\tthis.el.set_relative_to(btn);",
    "",
    "\tthis.el.set_position(Gtk.PositionType.RIGHT);",
    "",
    "\t// window + header?",
    "\t// print(\"SHOWALL - POPIP\\n\");",
    "\tthis.el.set_size_request(800,500);",
    "\tthis.el.show_all();",
    "\t//this.view.el.grab_focus();",
    "",
    "}",
    ""
   ]
  }
 ],
 "modOrder" : "",
 "name" : "ValaProjectSettingsPopover",
 "parent" : "",
 "path" : "/home/alan/gitlive/roobuilder/src/Builder4/ValaProjectSettingsPopover.bjs",
 "permname" : "",
 "title" : ""
}